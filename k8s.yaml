一、升级内核
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm ;yum --enablerepo=elrepo-kernel install  kernel-lt-devel kernel-lt -y

#查看默认启动顺序
awk -F\' '$1=="menuentry " {print $2}' /etc/grub2.cfg  

[root@master1 soft]# awk -F\' '$1=="menuentry " {print $2}' /etc/grub2.cfg 

CentOS Linux (4.4.106-1.el7.elrepo.x86_64) 7 (Core)
CentOS Linux (3.10.0-514.el7.x86_64) 7 (Core)
CentOS Linux (0-rescue-e2dd1004ad6b4a94af3fe1b58b14919a) 7 (Core)

#默认启动的顺序是从0开始，新内核是从头插入（目前位置在0，而4.4.4的是在1），所以需要选择0。

grub2-set-default 0 

#重启
reboot

#检查内核，成功升级到4.4
uname -a
Linux master1 4.4.106-1.el7.elrepo.x86_64 #1 SMP Sat Dec 16 08:49:32 EST 2017 x86_64 x86_64 x86_64 GNU/Linux

二、安装docker
#查看是否已安装有docker
sudo yum list installed | grep docker 
#删除已有docker
sudo yum -y remove docker docker-common docker-selinux docker-engine docker-engine-selinux container-selinux docker-ce
rm -rf /var/lib/docker

#安装
yum install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-selinux-17.03.2.ce-1.el7.centos.noarch.rpm 
yum install docker-ce-17.03.2.ce-1.el7.centos 


#关闭交换分区
swapoff -a; sed 's/.*swap.*/#&/' /etc/fstab
#
cat <<EOF >  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
vm.swappiness=0
EOF
sysctl -p /etc/sysctl.d/k8s.conf 




userdel catty;useradd alfred;usermod -aG docker alfred
mkdir /opt/cni /etc/cni;chcon -Rt svirt_sandbox_file_t /etc/cni;chcon -Rt svirt_sandbox_file_t /opt/cni



192.168.100.234  master1
192.168.100.235  master2
192.168.100.236  master3
192.168.100.231  node1
192.168.100.232  node2
192.168.100.233  node3

useradd alfred; echo 'password' | passwd --stdin alfred; usermod -aG docker alfred


sudo yum -y remove docker docker-common docker-selinux docker-engine docker-engine-selinux container-selinux docker-ce; rm -rf /var/lib/docker ;rm -rf /data/docker;  curl https://releases.rancher.com/install-docker/17.03.sh | sh; systemctl enable docker




{
    "CN": "kubernetes",
    "hosts": [
    "127.0.0.1",
    "192.168.100.231",
    "192.168.100.232",
    "192.168.100.233",
    "192.168.100.234",
    "192.168.100.235",
    "192.168.100.236",
    "172.21.0.1",
    "kubernetes",
    "kubernetes.default",
    "kubernetes.default.svc",
    "kubernetes.default.svc.cluster",
    "kubernetes.default.svc.cluster.local"
     ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "Shenzhen",
            "L": "Shenzhen",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
HERE



{
    "CN": "kubernetes",
    "hosts": [
        "127.0.0.1",
        "10.254.0.1",
        "192.168.100.231",
        "192.168.100.232",
        "192.168.100.233",
        "192.168.100.234",
        "192.168.100.235",
        "192.168.100.236",
        "*.kubernetes.master",
        "localhost",
        "kubernetes",
        "kubernetes.default",
        "kubernetes.default.svc",
        "kubernetes.default.svc.cluster",
        "kubernetes.default.svc.cluster.local"
    ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "BeiJing",
            "L": "BeiJing",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
